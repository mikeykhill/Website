<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MH Servers</title>

  <!-- Faster font loads -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    /* =========================================================
       THEME TOKENS (dark only)
       ========================================================= */
    :root {
      --bg-dark: #121212;
      --text-dark: #eee;
      --button-bg-dark: rgba(255, 255, 255, 0.08);
      --button-border-dark: rgba(102, 204, 255, 0.25);
      --button-hover-bg-dark: rgba(255, 255, 255, 0.12);
      --button-hover-border-dark: rgba(153, 221, 255, 0.6);

      /* Accents */
      --accent-1: #67d3ff;
      --accent-2: #6aa8ff;
      --accent-3: #8a6bff;

      /* Fit-to-viewport scale for mobile (set via JS) */
      --fit-scale: 1;
    }

    /* INTRO ANIMATION: register custom property so it can animate in transform */
    @property --intro-ty {
      syntax: "<length-percentage>";
      inherits: false;
      initial-value: 0px;
    }

    /* =========================================================
       BASE LAYOUT
       ========================================================= */
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      min-height: 100dvh; /* visible viewport height (mobile-safe) */
      overflow-x: hidden;
    }
    body {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      font-family: 'Inter', sans-serif;
      transition: background-color 0.5s, color 0.5s;
      position: relative;
      text-shadow: 0 0 5px rgba(0,0,0,0.7);
    }

    /* Everything you see sits in #app. On mobile we scale #app to fit. */
    #fit-wrapper {
      /* Desktop: normal document flow; Mobile: becomes a fixed viewport frame */
      width: 100%;
      height: 100%;
      min-height: 100dvh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      overflow: hidden; /* ensures no scroll when scaled */
    }
    #app {
      width: 100%;
      max-width: 900px;        /* roomy on desktop, still centered */
      padding: 30px 20px 60px; /* default desktop spacing */
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform-origin: top center;           /* scaling anchor */
      transform: scale(var(--fit-scale));     /* mobile scaling is applied here */
    }

    /* Headings / intro text */
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      margin: 6px 0 5px;
      text-align: center;
      user-select: none;
    }
    p#greeting {
      font-weight: 600;
      font-size: 1.3rem;
      margin: 0 0 6px;
      text-align: center;
      color: #66ccff;
      user-select: none;
      text-shadow: 0 0 6px #3399ff;
    }
    p#welcome {
      font-weight: 400;
      font-size: 1.2rem;
      margin: 0 0 24px;
      text-align: center;
      max-width: 640px;
      user-select: none;
    }

    /* =========================================================
       CTA BUTTONS GRID (glass cards)
       ========================================================= */
    .button-container {
      display: grid;
      grid-template-columns: repeat(2, minmax(240px, 1fr));
      gap: 22px;
      width: 100%;
      max-width: 680px;
      margin-bottom: 28px;
      perspective: 1000px; /* helps subtle 3D tilt on desktop */
    }
    .service-group { display: flex; flex-direction: column; align-items: center; }

    .service-button,
    .service-button .icon { will-change: transform; }

    .service-button {
      --tilt-x: 0deg; --tilt-y: 0deg;
      /* INTRO ANIMATION: variable used for initial slide-in */
      --intro-ty: 0px;

      position: relative; isolation: isolate;
      border: 1px solid var(--button-border-dark);
      background: var(--button-bg-dark);
      color: inherit;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 16px 18px;
      min-height: 78px;
      display: flex; align-items: center; justify-content: center; gap: 12px;
      font-size: 1rem; font-weight: 600;
      width: 100%;
      cursor: pointer;

      /* INTRO ANIMATION: include translateY via CSS var before existing rotations */
      transform: translate3d(0, var(--intro-ty), 0) rotateX(var(--tilt-x)) rotateY(var(--tilt-y)) translateZ(0);

      box-shadow: 0 10px 20px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.04);
      transition: transform 220ms ease, box-shadow 220ms ease, background-color 200ms ease, border-color 200ms ease, color 200ms ease, filter 200ms ease;
      overflow: hidden;

      /* INTRO ANIMATION: start hidden until animated in (keeps layout) */
      opacity: 0;
    }

    /* Animated gradient border */
    .service-button::before {
      content: "";
      position: absolute; inset: -2px; border-radius: inherit;
      background: conic-gradient(from 0deg, var(--accent-1), var(--accent-2), var(--accent-3), var(--accent-2), var(--accent-1));
      z-index: -1;
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      mask-composite: exclude; -webkit-mask-composite: xor;
      padding: 2px; opacity: 0; animation: spin 6s linear infinite paused;
      transition: opacity 250ms ease, filter 250ms ease;
      filter: blur(0px);
    }
    /* Shine sweep */
    .service-button::after {
      content: ""; position: absolute; inset: 0; border-radius: inherit;
      background: radial-gradient(120% 60% at 0% 0%, rgba(255,255,255,0.08), rgba(255,255,255,0) 60%) ,
                  linear-gradient(120deg, rgba(255,255,255,0) 35%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0) 65%);
      transform: translateX(-120%); transition: transform 700ms ease; pointer-events: none;
    }

    /* ✨ Enhanced hover state: aura + faster border spin + soft bloom */
    .service-button:hover {
      transform: translate3d(0, var(--intro-ty), 0) translateY(-4px) rotateX(var(--tilt-x)) rotateY(var(--tilt-y));
      border-color: var(--button-hover-border-dark);
      background: var(--button-hover-bg-dark);
      box-shadow:
        0 16px 32px rgba(0,0,0,0.35),
        0 0 0 1px rgba(153,221,255,0.25) inset,
        0 0 24px rgba(102,204,255,0.2);
      color: #cfeeff;
      filter: drop-shadow(0 0 10px rgba(103, 211, 255, 0.25));
    }
    .service-button:hover::before {
      opacity: 0.95;
      animation-play-state: running;
      animation-duration: 3.2s; /* faster while hovering */
      filter: blur(1px);
    }
    .service-button:hover::after  { transform: translateX(120%); }

    /* Click ripple (existing) */
    .service-button .ripple {
      position: absolute; border-radius: 50%; pointer-events: none;
      transform: scale(0); opacity: 0.35;
      background: radial-gradient(circle, #ffffff 0%, rgba(255,255,255,0) 70%);
      animation: ripple 650ms ease-out forwards; mix-blend-mode: screen;
    }

    .icon { width: 36px; height: 36px; flex-shrink: 0; transition: transform 220ms ease; }
    .service-button:hover .icon { transform: translateY(-1px) scale(1.04) rotate(-0.5deg); }
    body:not(.light) .icon { fill: #66ccff; } /* dark fill */

    /* Small app-store buttons beneath each service */
    .sub-buttons { display: flex; justify-content: center; gap: 8px; margin-top: 8px; }
    .small-btn {
      background-color: rgba(255, 255, 255, 0.1);
      padding: 4px 10px; font-size: 0.75rem; border-radius: 5px;
      text-decoration: none; transition: background-color 0.2s ease;
      color: inherit; border: 1px solid rgba(255,255,255,0.2);
    }
    .small-btn:hover { background-color: rgba(255, 255, 255, 0.25); }

    /* =========================================================
       WEATHER / CLOCK
       ========================================================= */
    #weather-clock {
      margin-bottom: 22px;
      display: flex; flex-direction: column; gap: 6px; align-items: center;
      font-size: 1.2rem; font-weight: 500; color: #99ccff; user-select: none;
      text-shadow: 0 0 5px rgba(0,0,0,0.7); z-index: 10; position: relative;
    }
    #location { font-weight: 600; font-size: 1.05rem; color: #aaccff; text-shadow: 0 0 4px rgba(0,0,0,0.6); user-select: none; text-align: center; }
    #citystate { font-weight: 700; font-size: 1.15rem; color: #bbddff; margin-bottom: 3px; text-shadow: 0 0 6px rgba(51,153,255,0.7); user-select: none; text-align: center; }

    /* =========================================================
       TOP-RIGHT "AI" BUTTON (replaces theme toggle)
       ========================================================= */
    #ai-btn {
      position: fixed; top: 16px; right: 16px;
      padding: 8px 14px; font-size: 0.9rem; font-weight: 600;
      border-radius: 20px; cursor: pointer; user-select: none;
      transition: background-color 0.3s, border-color 0.3s, color 0.3s;
      border: 2px solid var(--button-border-dark);
      background-color: rgba(31, 31, 31, 0.9);
      color: var(--text-dark); z-index: 30; text-shadow: inherit;
    }
    #ai-btn:hover { background-color: var(--button-hover-bg-dark); border-color: var(--button-hover-border-dark); color: #99ddff; }

    /* =========================================================
       RESPONSIVE TWEAKS (content size tuned for fitting)
       ========================================================= */
    @media (max-width: 560px) {
      #app { padding: 18px 14px 24px; }

      h1 { font-size: clamp(1.35rem, 6vw, 1.8rem); margin: 4px 0; }
      p#greeting { font-size: 1.05rem; margin: 2px 0 4px; }
      p#welcome { font-size: 1rem; margin: 0 0 16px; }

      #weather-clock { gap: 4px; font-size: 1.05rem; margin-bottom: 14px; }
      #citystate { font-size: 1.05rem; }
      #location  { font-size: 0.95rem; }

      .button-container {
        grid-template-columns: 1fr;
        gap: 12px;
        max-width: 520px;
        margin-bottom: 14px;
      }
      .service-button {
        min-height: 72px;
        border-radius: 14px;
        padding: 14px 14px;
      }
      .icon { width: 30px; height: 30px; }

      .sub-buttons { gap: 6px; margin-top: 6px; }
      .small-btn { font-size: 0.72rem; padding: 4px 8px; }
    }

    /* =========================================================
       BACKGROUND BUBBLES
       ========================================================= */
    #bg-animation-3 {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100dvh; z-index: -1; pointer-events: none; overflow: hidden;
    }
    .bubble {
      position: absolute; border-radius: 50%; opacity: 0.5;
      animation-timing-function: ease-in-out; animation-iteration-count: infinite;
      transition: background-color 0.5s ease; background-color: #66ccff;
    }
    @keyframes floatBubble { 0%,100%{transform: translateY(0);} 50%{transform: translateY(-20px);} }

    /* =========================================================
       ANIMATIONS
       ========================================================= */
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes ripple { to { transform: scale(8); opacity: 0; } }

    /* INTRO ANIMATION: slide up + fade for service buttons */
    @keyframes btnIntro {
      from {
        --intro-ty: 100vh;  /* start from bottom of screen */
        opacity: 0;
      }
      to {
        --intro-ty: 0px;
        opacity: 1;
      }
    }
    /* Apply animation with slower duration and 0.25s stagger */
    .button-container.intro .service-group:nth-child(1) .service-button { animation: btnIntro 600ms cubic-bezier(0.22, 1, 0.36, 1) both; animation-delay: 0ms; }
    .button-container.intro .service-group:nth-child(2) .service-button { animation: btnIntro 600ms cubic-bezier(0.22, 1, 0.36, 1) both; animation-delay: 250ms; }
    .button-container.intro .service-group:nth-child(3) .service-button { animation: btnIntro 600ms cubic-bezier(0.22, 1, 0.36, 1) both; animation-delay: 500ms; }
    .button-container.intro .service-group:nth-child(4) .service-button { animation: btnIntro 600ms cubic-bezier(0.22, 1, 0.36, 1) both; animation-delay: 750ms; }

    /* Accessibility */
    .service-button:focus-visible {
      outline: 2px solid currentColor;
      outline-offset: 3px;
      box-shadow: 0 0 0 4px rgba(102, 204, 255, 0.25);
    }
    @media (prefers-reduced-motion: reduce) {
      .service-button, .service-button::before, .service-button::after, .icon { transition: none !important; animation: none !important; }
      .service-button { transform: none !important; opacity: 1 !important; } /* INTRO ANIMATION: show instantly when reduced motion */
      .bubble { animation: none !important; }
    }
  </style>
</head>
<body>
  <!-- Replaced theme toggle with AI button (always dark mode) -->
  <button id="ai-btn" aria-label="Open AI site" type="button">🤖 AI</button>

  <!-- Everything else scales as one unit on mobile -->
  <div id="fit-wrapper">
    <div id="app">
      <h1>MH Servers</h1>
      <p id="greeting">Hello!</p>
      <p id="welcome">Easily access the Hill Jellyfin media server, Nextcloud file server, and more.</p>

      <div id="weather-clock" aria-live="polite" aria-atomic="true">
        <div id="citystate" aria-label="City and state">Loading city and state...</div>
        <div id="location" aria-label="User latitude and longitude">Loading location...</div>
        <div id="clock" aria-label="Local time">Loading time...</div>
        <div id="weather" aria-label="Local weather">
          <span id="weather-icon" style="vertical-align: middle; font-size: 1.2em; display: none;"></span>
          <span id="weather-text">Loading weather...</span>
        </div>
      </div>

      <div class="button-container">
        <!-- Jellyfin -->
        <div class="service-group">
          <button class="service-button" id="jellyfin-btn" type="button" aria-describedby="tooltip-jellyfin">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
              <path d="M32 2C20 2 8 10 8 26c0 4 1 8 3 12l2 4h38l2-4c2-4 3-8 3-12C56 10 44 2 32 2zm0 4c10.5 0 20 6.5 20 20 0 3.3-0.8 6.6-2.6 10H14.6C12.8 32.6 12 29.3 12 26c0-13.5 9.5-20 20-20zm-4 40v4h-4v6a2 2 0 0 0 4 0v-2h2v2a2 2 0 0 0 4 0v-6h-4v-4h-2zm12 0v4h-4v6a2 2 0 0 0 4 0v-2h2v2a2 2 0 0 0 4 0v-6h-4v-4h-2zm-24 0v4h-4v6a2 2 0 0 0 4 0v-2h2v2a2 2 0 0 0 4 0v-6h-4v-4h-2z"/>
            </svg>
            Jellyfin
          </button>
          <div class="sub-buttons">
            <a href="https://play.google.com/store/apps/details?id=org.jellyfin.mobile" target="_blank" class="small-btn" rel="noopener">📱 Android</a>
            <a href="https://apps.apple.com/us/app/jellyfin-mobile/id1480192618" target="_blank" class="small-btn" rel="noopener">🍎 iOS</a>
          </div>
        </div>

        <!-- Nextcloud -->
        <div class="service-group">
          <button class="service-button" id="nextcloud-btn" type="button" aria-describedby="tooltip-nextcloud">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M3 7a2 2 0 0 1 2-2h5l2 2h7a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7z"/>
            </svg>
            Nextcloud
          </button>
          <div class="sub-buttons">
            <a href="https://play.google.com/store/apps/details?id=com.nextcloud.client" target="_blank" class="small-btn" rel="noopener">📱 Android</a>
            <a href="https://apps.apple.com/us/app/nextcloud/id1125420102" target="_blank" class="small-btn" rel="noopener">🍎 iOS</a>
          </div>
        </div>

        <!-- File Converter -->
        <div class="service-group">
          <button class="service-button" id="converter-btn" type="button">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M12 4V1L8 5l4 4V6c3.3 0 6 2.7 6 6 0 1.1-.3 2.1-.8 3l1.5 1.5C19.6 15.1 20 13.6 20 12c0-4.4-3.6-8-8-8zm-6.7 1.5L3.8 7c-.5 1-.8 2-.8 3 0 4.4 3.6 8 8 8v3l4-4-4-4v3c-3.3 0-6-2.7-6-6 0-1.1.3-2.1.8-3z"/>
            </svg>
            File Converter
          </button>
        </div>

        <!-- ROMs -->
        <div class="service-group">
          <button class="service-button" id="roms-btn" type="button">
            <!-- Joy-Con style icon -->
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
              <rect x="20" y="6" width="24" height="52" rx="12" ry="12" fill="currentColor"/>
              <circle cx="32" cy="20" r="3" />
              <circle cx="32" cy="30" r="3" />
              <circle cx="32" cy="40" r="3" />
              <circle cx="32" cy="50" r="3" />
            </svg>
            ROMs-
          </button>
        </div>
      </div>

      <footer style="user-select:none; color: inherit; font-size:0.9rem; text-align:center;">
        &copy; 2025 Michael Hill &mdash;
      </footer>
    </div>
  </div>

  <!-- Background animation container -->
  <div id="bg-animation-3"></div>

  <script>
    /* =======================================================
       DOM HOOKS
       ======================================================= */
    const greetingEl = document.getElementById('greeting');
    const cityStateEl = document.getElementById('citystate');
    const locationEl = document.getElementById('location');
    const clockEl = document.getElementById('clock');
    const weatherTextEl = document.getElementById('weather-text');
    const bgContainer = document.getElementById('bg-animation-3');
    const app = document.getElementById('app');
    const fitWrapper = document.getElementById('fit-wrapper');
    /* INTRO ANIMATION: container for the four buttons */
    const buttonContainer = document.querySelector('.button-container');

    /* =======================================================
       AI BUTTON LINK
       ======================================================= */
    document.getElementById('ai-btn').addEventListener('click', () => {
      window.open('https://ai.mhservers.com', '_blank', 'noopener,noreferrer');
    });

    /* =======================================================
       BACKGROUND BUBBLES (dark palette only)
       ======================================================= */
    const bubbleColorsDark = [
      'rgba(102, 217, 255, 0.3)',
      'rgba(128, 229, 255, 0.3)',
      'rgba(170, 245, 255, 0.3)'
    ];
    const BUBBLE_COUNT = window.matchMedia('(max-width: 560px)').matches ? 60 : 100;

    function createBubble() {
      const bubble = document.createElement('div');
      bubble.classList.add('bubble');
      const size = 15 + Math.random() * 15;
      bubble.style.width = bubble.style.height = size + 'px';
      bubble.style.left = (Math.random() * 100) + 'vw';
      bubble.style.top = (Math.random() * 90) + 'vh';
      bubble.style.animationName = 'floatBubble';
      bubble.style.animationDuration = (4 + Math.random() * 4) + 's';
      bubble.style.animationDelay = (Math.random() * 6) + 's';
      bubble.style.backgroundColor = bubbleColorsDark[Math.floor(Math.random() * bubbleColorsDark.length)];
      return bubble;
    }
    function populateBubbles() {
      bgContainer.innerHTML = '';
      for (let i = 0; i < BUBBLE_COUNT; i++) bgContainer.appendChild(createBubble());
    }
    populateBubbles();

    /* =======================================================
       GREETING + CLOCK
       ======================================================= */
    const timeFmt = new Intl.DateTimeFormat([], { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
    function updateGreeting() {
      const hour = new Date().getHours();
      greetingEl.textContent = (hour >= 5 && hour < 12) ? 'Good morning,' :
                               (hour >= 12 && hour < 18) ? 'Good afternoon,' : 'Good evening,';
    }
    function updateClock() { clockEl.textContent = timeFmt.format(new Date()); }
    updateGreeting(); updateClock();
    setInterval(() => { updateClock(); updateGreeting(); }, 1000);

    /* =======================================================
       WEATHER
       ======================================================= */
    const emojiMap = [
      { keywords: ['clear', 'sunny'], icon: '☀️' },
      { keywords: ['partly', 'mostly sunny'], icon: '🌤️' },
      { keywords: ['cloud', 'overcast'], icon: '☁️' },
      { keywords: ['rain', 'shower', 'drizzle'], icon: '🌧️' },
      { keywords: ['thunder'], icon: '⛈️' },
      { keywords: ['snow'], icon: '❄️' },
      { keywords: ['fog', 'mist', 'haze'], icon: '🌫️' },
    ];
    async function fetchWeather() {
      if (!navigator.geolocation) {
        cityStateEl.textContent = 'Geolocation not supported'; locationEl.textContent = ''; weatherTextEl.textContent = '';
        return;
      }
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude; const lon = pos.coords.longitude;

        try {
          const geoResp = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`);
          if (!geoResp.ok) throw new Error();
          const geoData = await geoResp.json();
          const address = geoData.address || {};
          const city = address.city || address.town || address.village || address.hamlet || '';
          const state = address.state || address.county || '';
          cityStateEl.textContent = (city && state) ? `${city}, ${state}` : 'Unknown Location';
        } catch { cityStateEl.textContent = 'Location unavailable'; }

        try {
          const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=84acb4b38fbe409b9b3131518250108&q=${lat},${lon}&aqi=no`);
          if (!response.ok) throw new Error();
          const data = await response.json();
          const city = data.location.name; const region = data.location.region || data.location.country;
          cityStateEl.textContent = `${city}, ${region}`;
          locationEl.textContent = `Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}`;
          const tempF = data.current.temp_f; const wind = data.current.wind_mph;
          const conditionText = data.current.condition.text; const condition = conditionText.toLowerCase();
          let emoji = '🌡️'; for (const { keywords, icon } of emojiMap) { if (keywords.some(w => condition.includes(w))) { emoji = icon; break; } }
          weatherTextEl.textContent = `Temp: ${tempF}°F, Wind: ${wind} mph, ${conditionText} ${emoji}`;
          fitToViewport(); // weather text length can slightly change height
        } catch {
          locationEl.textContent = `Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}`;
          weatherTextEl.textContent = 'Weather data unavailable';
          fitToViewport();
        }
      });
    }
    fetchWeather();

    /* =======================================================
       BUTTON HANDLERS
       ======================================================= */
    document.getElementById('jellyfin-btn').addEventListener('click', () => {
      window.open('https://jellyfin.mhservers.com', '_blank', 'noopener,noreferrer');
    });
    document.getElementById('nextcloud-btn').addEventListener('click', () => {
      window.open('https://nextcloud.mhservers.com', '_blank', 'noopener,noreferrer');
    });
    document.getElementById('converter-btn').addEventListener('click', () => {
      window.open('https://convertx.mhservers.com', '_blank', 'noopener,noreferrer');
    });
    document.getElementById('roms-btn').addEventListener('click', () => {
      window.open('https://rom.mhservers.com', '_blank', 'noopener,noreferrer');
    });

    /* =======================================================
       DESKTOP-ONLY: tilt + ripple (disabled on touch)
       ======================================================= */
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const hasFineHover = window.matchMedia('(hover: hover) and (pointer: fine)').matches;
    if (hasFineHover && !prefersReduced) {
      const cards = document.querySelectorAll('.service-button');
      cards.forEach(card => {
        let lastX = 0, lastY = 0, rect = null, ticking = false;

        card.addEventListener('pointerenter', () => {
          rect = card.getBoundingClientRect();
        });

        card.addEventListener('pointerleave', () => {
          rect = null;
          card.style.setProperty('--tilt-x', '0deg');
          card.style.setProperty('--tilt-y', '0deg');
        });

        card.addEventListener('pointermove', (e) => {
          if (!rect) return;
          lastX = e.clientX - rect.left; lastY = e.clientY - rect.top;
          if (ticking) return; ticking = true;
          requestAnimationFrame(() => {
            const midX = rect.width / 2, midY = rect.height / 2;
            const rotateY = ((lastX - midX) / midX) * 6;
            const rotateX = -((lastY - midY) / midY) * 6;
            card.style.setProperty('--tilt-x', rotateX.toFixed(2) + 'deg');
            card.style.setProperty('--tilt-y', rotateY.toFixed(2) + 'deg');
            ticking = false;
          });
        });

        card.addEventListener('click', (e) => {
          const r = card.getBoundingClientRect();
          const ripple = document.createElement('span');
          ripple.className = 'ripple';
          const size = Math.max(r.width, r.height) * 0.5;
          ripple.style.width = ripple.style.height = size + 'px';
          ripple.style.left = (e.clientX - r.left - size / 2) + 'px';
          ripple.style.top  = (e.clientY - r.top  - size / 2) + 'px';
          card.appendChild(ripple);
          ripple.addEventListener('animationend', () => ripple.remove());
        });
      });
    }

    /* =======================================================
       INTRO ANIMATION: trigger on initial page load
       ======================================================= */
    window.addEventListener('load', () => {
      if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches && buttonContainer) {
        buttonContainer.classList.add('intro');
      }
    });

    /* =======================================================
       MOBILE: FIT EVERYTHING TO THE VIEWPORT (NO SCROLL)
       ======================================================= */
    const isSmallScreen = () => window.matchMedia('(max-width: 560px)').matches;

    function fitToViewport() {
      if (!isSmallScreen()) {
        document.documentElement.style.setProperty('--fit-scale', '1');
        document.body.style.overflowY = 'auto';
        return;
      }
      // Lock scrolling on mobile:
      document.body.style.overflowY = 'hidden';

      // Measure app height at natural size:
      const naturalScale = 1;
      app.style.transform = `scale(${naturalScale})`; // reset scale to measure accurately
      const available = window.innerHeight;           // 100dvh in JS terms
      const needed = app.getBoundingClientRect().height;

      // Compute scale to fit, but never upscale:
      const scale = Math.min(1, available / needed);

      // Apply scale via CSS var:
      document.documentElement.style.setProperty('--fit-scale', String(scale));

      // After scaling, ensure wrapper consumes the viewport (no scrollbars)
      fitWrapper.style.height = available + 'px';
    }

    // Run on load, after fonts settle, and on resize/orientation changes
    window.addEventListener('load', fitToViewport);
    // Fonts can change metrics late; give one more pass:
    setTimeout(fitToViewport, 300);
    window.addEventListener('resize', fitToViewport);
    window.addEventListener('orientationchange', () => setTimeout(fitToViewport, 50));
    // System theme changes no longer affect layout (dark-only)
  </script>
</body>
</html>
